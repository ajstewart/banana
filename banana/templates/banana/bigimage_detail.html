{% extends "base.html" %}

{% block title %}Image {{ image.id }} Â· Banana{% endblock title %}

{% block morehead %}
    <link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}/js9/js9support.css">
    <link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}/js9/js9.css">
    <script type="text/javascript" src="{{ STATIC_URL }}/js9/js9support.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}/js9/js9.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}/js9/js9plugins.js"></script>
{% endblock %}

{% block bodytag %}<body  onload="init()" class="hold-transition skin-blue sidebar-mini">{% endblock %}

{% block navdatabase %}<li><a href="{% url 'datasets' db_name %}">Database {{ db_name }}</a></li>{% endblock navdatabase %}
{% block navdataset %}<li><a href="{% url 'dataset' db_name image.dataset_id %}">Dataset {{ image.dataset_id }}</a></li>{% endblock %}
{% block navdeep %}<li><a href="{% url 'images' db_name %}?dataset={{ image.dataset_id }}">Images</a></li>{% endblock %}
{% block navdeeper %}<li class="active"><a href="{% url 'image' db_name image.id %}">Image {{ image.id }}</a></li>{% endblock %}


{% block content %}
    <div class="container-fluid">

        <div id="size1024">
            <div class="JS9Menubar" id="JS9-1024_Menubar" data-width="1024px"></div>
            <div class="JS9" id="JS9-1024" data-width="1024px" data-height="1024px"></div>
        </div>
    </div>

    <script type="text/javascript">
        function init(){
            JS9.Load("{%  url 'rawimage' db_name object.id %}", {onload: doit});
        }

        var extract_types = ["blind fit", "forced fit", "monitored position"]

        function doit(){
            var sources = [];

            var opt = $.extend(true, {}, JS9.Catalogs.opts);
            opt.tooltip =
                    "<b>id: $xreg.data.id<\/b><br>" +
                    "x: $xreg.x<br>y: $xreg.y<br>" +
                    "ra: $xreg.data.ra<br>" +
                    "decl: $xreg.data.decl<br>" +
                    "type: $xreg.data.type";
            opt.onmouseup = function(im, xreg, evt){
                window.open(xreg.data.url);
            };


            {% for point in lightcurve  %}
            pix = JS9.WCSToPix({{ point.ra }}, {{ point.decl }});
            data = {
                id: {{ point.id }},
                type: extract_types[{{ point.extract_type }}],
                ra: {{ point.ra }},
                decl: {{ point.decl }},
                url: "{% url 'extractedsource' db_name point.id %}"
            }

            {%  if point.extract_type == 0 %}sources.push({x: pix.x, y: pix.y, shape: "box", color: "yellow", radius: 5, data: data});
            {% elif point.extract_type == 1 %}sources.push({x: pix.x, y: pix.y, shape: "circle", color: "lightgreen", radius: 5, data: data});
            {% elif point.extract_type == 2 %}sources.push({x: pix.x, y: pix.y, shape: "circle", color: "red", radius: 5, data: data});
            {% endif %}{% endfor %}

            JS9.NewShapeLayer("extracted sources", opt);
            JS9.AddShapes("extracted sources", sources);


            //JS9.NewShapeLayer("Monitoring list", opt);
            //JS9.AddShapes("Monitoring list", monitor);
        }
    </script>

{% endblock content %}


